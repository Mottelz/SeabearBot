const Twit = require('twit')
const config = require('./config')
const bot = new Twit(config)
const rita = require('rita')

const tweetBot = () => {
    markov = rita.RiMarkov(2)
    inputText = "Draped in the night by constellations shifting. A quiver in the cold. Her, a bonfire against cautionary winds, telling me to turn back or freeze out here. She thaws the permafrost, she melts the ice, and I want to fall through, into the lake below.We skirt around the idea. Laughing over fictions. But we have an understanding, unspoken and raw. It's like spare silver bullets, just in-case we miss the werewolf the first time around, and he just fucks off into the woods. Rye on ice, amber and smoke. Everyone laughing. I smile too. But it isn't worth the drink I sip, in reverence of your mercy. So I smashed the glass and pulled at her rings and dumped her music box and refused that it sing. The halo of lights that ran around her stall went dark one by one until dark covered all. But I heard the fortune teller’s machine start once again, and a card slid out in the dark and the din. You are far too beautiful for the likes of this face. The alligator meets the swan, the apocalypse meets grace. But I get to keep the horsemen and teeth away from you. I get to bend your ear for evenings far between and few. Time has healed us both, unharmed by former ghosts. Now we wander alone the snowy roads, speaking quietly in the folds of the blue gloam. Midnight departures, dreams of woven limbs. The smell of chamomile on my thread-worn sin. It's a little unstable here and it tastes just like gin. I saw the ghost of St. Peter steal the gold from a tooth he’d taken from the mouth of a lover on the loose. The only god damn thing left he could say was 'I’ve seen worse, I’ve seen worse in my day.' You shouldn't worry about things remanded, and the coming of the morning blue. I know the heart can get so heavy-handed. Decoding the signals, if you only knew. But that's why we've unmade the bed, to sleep and hide away, head to tired head. Until all we hear is nothing we said. I am a revenant body, lost in the wake. The foam of the ocean crawling up my legs. I had a dream it would end like this. The baptism couldn't hold in my soul. Eating animals and spitting gristle. Awaiting that old god to uphold any sense of urgency to warm the cold. Not that there's much up there to see. Just a throne made of gold and some fallen trees. Chained wrists connected to chained wrists, of some devil with red skin and rough spear. Snapping my fingers to get his attention before he realizes his father was a bastard. And I'm in love. And I have to get out of here. I am entombed by the dunes. Hair the color of hay, laid across my face. Unrepentant in my search for you. How such a deity spoke to such a lowly creature, it's beyond my comprehension. We learned to love by the compass. Never followed tracks of chalk. Speared my foot through with a cross, so that I may always walk in grace. Bitter and sweet met without me. Ivory feet turning blue in the winter sea. Lay me gentle atop all of your shoulders. Lift me, carry me, to the feet of the son of the morning. Ask him what he's made in so many dreadful days. He'll call me his boy, his precious bit of perdition, and as all fathers do, the devil will abandon me to the weeds. I envy the chemicals that keep us awake. God knows they stain all my mistakes. I spend the day wondering how scared I'll be, and how to masquerade a better me. So for now I'll scrape the snow from the eaves, into a whiskey glass full of the frozen leaves, that float so carelessly on the amber I need. Just to keep from shaking, to still the wild bounds. And all will be quiet, and all will be sound. I am one to watch the horizon, for fear of the coming storm. Knowing full well that the blue sky above is always lying. There are clouds and there is rain. Waiting, silent, over plains I can't see yet. And there's a restless sea inside the box where I keep everything you've given me. At night, I can hear it in the attic. The slow, deliberate push of the waves, knocking keepsakes around inside a few square feet of cardboard. Sometimes I think I hear myself up there, drowning or swimming. I never can tell which. Maybe I'm surviving, or maybe I'm just hearing things."
    markov.loadText(inputText)
    var sentence = markov.generateSentences(2).toString().substring(0, 140).replace('.,','. ')
    bot.post('statuses/update', {
        status: sentence
    }, (err, data, response) => {
        if (err) {
            console.log(err)
        } else {
            console.log('Markov status tweeted!', sentence)
        }
    }
    )
}

module.exports = tweetBot